<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<title>CadQuery Viewer</title>
	<link rel="stylesheet" href="{{cq-view-css}}" />

	<style>
		body {
			padding: 0;
			overflow: hidden;
		}
		.tcv_cad_viewer {
			margin: 0;
		}
	</style>

	<script type="module">
		import { Viewer } from '{{cq-view-js}}';

		let options = {
			cadWidth: window.innerWidth - 8,
			height: window.innerHeight - 43,
			treeWidth: 220,
			theme: 'browser',
			glass: true,
			control: 'trackball',
		};

		function render(model) {
			viewer.clear();
			const [ shapes, states ] = model;
			const [ group, tree ] = viewer.renderTessellatedShapes(shapes, states, options);
			viewer.render(group, tree, states, options);
		}

		function nc(change) {
			// console.debug('viewer info:', JSON.stringify(change, null, 2));
		}

		function updateView(new_options) {
			container.innerHTML = '';
			viewer = new Viewer(container, Object.assign({}, options, new_options), nc);
			viewer.trimUI(["axes", "axes0", "grid", "ortho", "more", "help"], false);
		}

		window.addEventListener('message', event => {
			// console.debug('received data:', JSON.stringify(event.data.model, null, 2));
			if (!viewer || event.data.options) {
				updateView(event.data.options ? event.data.options : {});
			}
			if (event.data.model) {
				render(event.data.model);
			}
		});
		window.addEventListener('resize', () => {
			updateView({
				cadWidth: window.innerWidth - 8,
				height: window.innerHeight - 43
			});
		});

		const container = document.getElementById('cad_view');
		let viewer = null;
	</script>
</head>

<body>
	<div id="cad_view"></div>
</body>

</html>
