<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<title>CadQuery Viewer</title>
	<link rel="stylesheet" href="{{cq-view-css}}" />
	<script src="{{cq-view-example}}"></script>

	<script type="module">
		import { Viewer } from '{{cq-view-js}}';

		let options = {
			cadWidth: 620,
			height: 540,
			treeWidth: 220,
			theme: 'browser',
			glass: true,
			control: 'trackball',
		};

		function render(shapes, states) {
			viewer?.clear();
			viewer.render(...viewer.renderTessellatedShapes(shapes, states, options), states, options);
		}

		function nc(change) {
			console.debug('viewer info:', JSON.stringify(change, null, 2));
		}

		function updateView() {
			container.innerHTML = '';
			viewer = new Viewer(container, options, nc);
			render(...hexapod);
		}

		window.addEventListener('message', event => {
			console.debug('received options:', JSON.stringify(event.data, null, 2));
			options = Object.assign({}, options, event.data);
			updateView();
		});

		const container = document.getElementById('cad_view');
		let viewer = null;
		updateView();
		console.log('Loaded', new Date());
	</script>
</head>

<body>
	<div id="cad_view"></div>
</body>

</html>
